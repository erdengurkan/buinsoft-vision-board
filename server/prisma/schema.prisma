generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Project {
  id          String    @id @default(uuid())
  title       String
  client      String
  assignee    String
  priority    String
  status      String
  startDate   DateTime
  endDate     DateTime
  deadline    DateTime?
  followUp    Boolean   @default(false)
  description String
  order       Int       @default(0)
  hardness    Int?      // 1-5 star rating for difficulty
  benefit     Int?      // 1-5 star rating for value
  sharedWithAll Boolean @default(true)  // Herkes görebilsin mi?
  sharedWith    String[]                // Paylaşılan kullanıcı isimleri listesi
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  tasks            Task[]
  labels           Label[]
  workflowStatuses WorkflowStatus[]  // Project-specific statuses
}

model Task {
  id          String    @id @default(uuid())
  title       String
  description String
  status      String
  assignee    String
  priority    String
  order       Int       @default(0)
  createdAt   DateTime  @default(now())
  deadline    DateTime?
  followUp    Boolean   @default(false)
  flowDiagram Json?     // Flow diagram data (nodes, edges, viewport)
  hardness    Int?      // 1-5 star rating for difficulty
  benefit     Int?      // 1-5 star rating for value
  
  projectId   String
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  worklogs    WorklogEntry[]
  activeTimer ActiveTimer?
}

model Label {
  id       String    @id @default(uuid())
  name     String
  color    String
  projects Project[]
}

model WorklogEntry {
  id          String   @id @default(uuid())
  durationMs  Int
  startedAt   DateTime
  stoppedAt   DateTime
  user        String
  description String?
  
  taskId      String
  task        Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
}

model Todo {
  id        String    @id @default(uuid())
  title     String
  completed Boolean   @default(false)
  createdAt DateTime  @default(now())
  deadline  DateTime?
  order     Int?
  mentions  String[]
  taskId    String?   // İlişkili task ID'si
  taskTitle String?   // Task başlığı (hızlı erişim için)
}

model WorkflowStatus {
  id        String   @id @default(uuid())
  name      String
  color     String
  order     Int
  type      String   // "project" or "task"
  projectId String?  // Link to specific project
  project   Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WorkflowLabel {
  id    String @id @default(uuid())
  name  String
  color String
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  role      String?  // Job role: "Lead Developer", "Senior Developer", etc.
  userRole  String   @default("User") // Permission role: "Admin" or "User"
  avatar    String?  // Avatar URL
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Comment {
  id        String   @id @default(uuid())
  projectId String
  taskId    String?
  text      String
  user      String
  timestamp DateTime @default(now())
  createdAt DateTime @default(now())
}

model ActivityLog {
  id          String   @id @default(uuid())
  projectId   String
  timestamp   DateTime @default(now())
  user        String
  actionType  String
  description String
  metadata    Json?
  createdAt   DateTime @default(now())
}

model ActiveTimer {
  id        String   @id @default(uuid())
  taskId    String   @unique
  projectId String
  startedAt DateTime
  userId    String
  createdAt DateTime @default(now())
  
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
}

model Customer {
  id        String   @id @default(uuid())
  name      String   // Required
  company   String?
  email     String?
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

